version: '3.8'

services:
  data-ingester:
    build: .
    container_name: wesense-ingester-meshtastic
    restart: unless-stopped

    volumes:
      - ./cache:/app/cache
      - ./config:/app/config:ro
      - ./logs:/app/logs

    environment:
      # ClickHouse Configuration
      - CLICKHOUSE_HOST=your-clickhouse-host
      - CLICKHOUSE_PORT=8123
      - CLICKHOUSE_DATABASE=wesense
      - CLICKHOUSE_USER=default
      - CLICKHOUSE_PASSWORD=

      # WeSense Output MQTT (for publishing decoded data)
      - WESENSE_OUTPUT_BROKER=your-mqtt-broker
      - WESENSE_OUTPUT_PORT=1883
      - WESENSE_OUTPUT_USERNAME=
      - WESENSE_OUTPUT_PASSWORD=

      # Timezone
      - TZ=UTC

      # Logging
      - DEBUG=false
      - LOG_LEVEL=INFO
      - LOG_MAX_BYTES=10485760
      - LOG_BACKUP_COUNT=5

    network_mode: bridge

    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "7"
